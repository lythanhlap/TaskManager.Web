@model TaskManager.Web.Models.TaskDetailsVm
@{
    ViewData["Title"] = "Chi tiết task";
    string Badge(TaskManager.Tasks.Abstractions.TaskStatus s) =>
        s == TaskManager.Tasks.Abstractions.TaskStatus.Complete ? "badge bg-success" : "badge bg-secondary";
    var Tname = Model.Name;
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">📝 @Model.Name</h3>
    <div class="d-flex gap-2">
        <a class="btn btn-sm btn-outline-primary"
           asp-action="Edit"
           asp-route-projectId="@Model.ProjectId"
           asp-route-taskId="@Model.Id">Sửa</a>

        <form asp-action="Delete"
              asp-route-projectId="@Model.ProjectId"
              asp-route-taskId="@Model.Id"
              method="post"
              onsubmit="return confirm('Xóa task \" Tname \"?');">
            @Html.AntiForgeryToken()
            <button class="btn btn-sm btn-outline-danger" type="submit">Xóa</button>
        </form>

        <a class="btn btn-sm btn-outline-secondary"
           asp-action="Index"
           asp-route-projectId="@Model.ProjectId">Quay lại</a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="mb-2">
            <span class="@Badge(Model.Status)">
                @(Model.Status == TaskManager.Tasks.Abstractions.TaskStatus.Complete ? "Hoàn thành" : "Chưa hoàn thành")
            </span>
        </div>

        @if (!string.IsNullOrWhiteSpace(Model.Description))
        {
            <p class="text-muted">@Model.Description</p>
        }

        <div class="row g-3">
            <div class="col-md-4"><strong>Bắt đầu:</strong> @(Model.StartAt?.ToString("g") ?? "-")</div>
            <div class="col-md-4"><strong>Kết thúc:</strong> @(Model.EndAt?.ToString("g") ?? "-")</div>
            <div class="col-md-4"><strong>Task Id:</strong> @Model.Id</div>
        </div>

        <hr />
        <div>
            <strong>Assignees:</strong>
            @if (Model.Assignees?.Any() == true)
            {
                <div class="mt-2 d-flex flex-wrap gap-2">
                    @foreach (var a in Model.Assignees)
                    {
                        <span class="badge rounded-pill text-bg-secondary">@($"@{a.Username}")</span>
                    }
                </div>
            }
            else
            {
                <span class="text-muted">chưa gán</span>
            }
        </div>
    </div>
</div>
